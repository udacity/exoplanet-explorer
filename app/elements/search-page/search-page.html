<!--
@license
Copyright (c) 2015 Udacity. All rights reserved.
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../behaviors/search-utilities.html">
<link rel="import" href="../behaviors/math-and-physics.html">

<dom-module id="search-page">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
      }
    </style>
    <h1>Search!</h1>
    <h2 class="query page-title">{{queryDisplay}}</h2>
    <paper-material>
      <h3>This is how you search!</h3>
    </paper-material>
    <paper-input type="text" placeholder="Search me!"></paper-input>
    <div class="search-results"></div>
  </template>

  <script>
    (function () {
      'use strict';
      // TODO: show difference between exact matches and close matches?
      Polymer({
        is: 'search-page',
        behaviors: [SearchUtilities, MathAndPhysics],
        created: function() {
          this.properties.resultsContainer.value = this.querySelector('.search-results');
        },
        attached: function() {
          var self = this;
          Model.requests.addListener('returnedQuery', function(data) {
            console.log(data);
            self.renderThumbnails(planets);
          });
        },
        loadData: function() {
          Model.requests.sendQuery('query', this.queryString);
        },
        renderThumbnails: function(planets) {
          for (var p in planets) {
            this.createPlanetThumb(planets[p]);
          }
        },
        parseQuery: function() {
          this.query = JSON.parse(this.queryString);
        },
        properties: {
          value: {
            type: String,
            notify: true,
          },
          range: {
            type: String,
            notify: true,
          },
          queryDisplay: {
            type: String,
            notify: true,
            value: 'Nothing yet! Try searching'
          },
          resultsContainer: {
            type: Object,
            notify: true
          },
          queryString: {
            type: String,
            notify: true,
            observer: 'parseQuery'
          },
          query: {
            type: Object,
            notify: true
          }
        },
        createPlanetThumb: function(data) {
          var pT = document.createElement('planet-thumb');
          for (var d in data) {
            pT[d] = data[d];
          }
          this.resultsContainer.appendChild(pT);
        },
        dataToThumbs: function(data) {
          // only load 100 thumbs at a time. mark number 80 with an event. when it's on screen, then load the next 100. and so on.
        }
      });
    })();
  </script>

</dom-module>
